(function(t,e,a){var n=e.fn.hide;e.fn.hide=function(){var t=n.apply(this,arguments);return e(this).trigger("hide"),t};var s=e.fn.show;e.fn.show=function(){var t=s.apply(this,arguments);return e(this).trigger("show"),t};var o=e.fn.html;e.fn.html=function(){var t=o.apply(this,arguments);return e(this).trigger("show"),e(this).trigger("html"),t};var r=e.fn.append;e.fn.append=function(){var t=r.apply(this,arguments);return e(this).trigger("append"),t};var l=e.fn.prepend;e.fn.prepend=function(){var t=l.apply(this,arguments);return e(this).trigger("prepend"),t},e.fn.animationEnd=function(t){var a="webkitAnimationEnd oAnimationEnd msAnimationEnd animationend";return e(this).one(a,t),this};var d=e("body"),c=t.XF=t.XF||{};c.Events=a.Events,_.extend(c,c.Events),c.navigate=function(t){c.Router.navigate(t,{trigger:!0})},c.on("navigate",c.navigate);var p=/\:/;c.on("all",function(t){if(console.log("XF:all - ",t),console.log(typeof t),p.test(t)){var e=t.split(p);if(!("component"!==e[0]&&3>e.length)){var a=e[1];if(c._defferedCompEvents||(c._defferedCompEvents={}),"component"===e[0]&&"constructed"===e[2]&&onComponentCostruct(a),!c.getComponentByID(a)){var n=c._defferedCompEvents[a]||(c._defferedCompEvents[a]=[]);n.push(t),c.on("component:"+a+":constructed",function(){_.each(n,function(t){c.trigger(t)})})}}}}),onComponentCostruct=function(t){console.log("constructed",t);var a=e(c.getComponentByID(t).selector());c.trigger("pages:start",a),f(a)},c.start=function(t){t=t||{},c.storage.init(),t.device=t.device||{},c.Device.init(t.device.types),"Touches"in c&&c.Touches.init(),t.router=t.router||{},h(t.router),u(),g(),_.has(c,"UI")&&c.UI.init(),c.Router.start(),t.animations=t.animations||{},t.animations.standardAnimation=t.animations.standardAnimation||"",_.has(c.Device.type,"defaultAnimation")&&(t.animations.standardAnimation=c.Device.type.defaultAnimation,console.log("Options.animations",t.animations)),c.Pages.init(t.animations),f(d)};var h=function(t){if(c.Router)throw"XF.createRouter can be called only ONCE!";c.Router=new(c.RouterClass.extend(t))},u=function(){e("body").on("tap click","[data-href]",function(){var t=e(this).data("animation")||null;t&&c.trigger("pages:animation:next",t),c.Router.navigate(e(this).data("href"),{trigger:!0})})},f=function(t){console.log("XF :: loadChildComponents",t),e(t).find("[data-component][data-cache=true],[data-component]:visible").each(function(t,a){console.log(a);var n=e(a).attr("data-id"),i=e(a).attr("data-component");m(n,i,!0)})},m=function(t,e){y(e,function(a){if(!x[t]){var n=new a(e,t);console.log("XF :: loadChildComponent - created : "+t),x[t]=n,c.trigger("component:"+t+":constructed")}})},g=function(){e("[data-component]").on("show",function(t){if(console.log("SHOWED",t.target),t.currentTarget==t.target){var a=e(this).attr("data-id");if(!x[a]){var n=e(this).attr("data-component");m(a,n)}c.trigger("ui:enhance",e(this))}})},v=function(t,e){var a=document.createElement("script");a.readyState?a.onreadystatechange=function(){("loaded"==a.readyState||"complete"==a.readyState)&&(a.onreadystatechange=null,e&&e())}:a.onload=function(){e&&e()},a.src=t,document.getElementsByTagName("head")[0].appendChild(a)},x={},b={},y=function(t,e){var a=b[t];return a||(a=c.registerComponent(t,c.settings.property("componentUrl")(t))),a.loaded?(e(a.compDef),void 0):(a.callbacks.push(e),a.loading||(a.loading=!0,v(a.compSrc)),void 0)};c.getComponentByID=function(t){return x[t]},c.registerComponent=function(t,e){var a=b[t];return a?a:(b[t]=new C(e),b[t])},c.defineComponent=function(t,e){console.log(t,e);var a=b[t];for(a||(a=b[t]=new C(null)),b[t].loading=!1,b[t].loaded=!0,b[t].compDef=e;a.callbacks.length;)a.callbacks.pop()(a.compDef)},c.requireComponent=function(t,e){y(t,e)};var w={};c.setOptionsByID=function(t,e){w[t]=e},c.getOptionsByID=function(t){return w[t]||{}},c.history=a.history,c.App=function(t){t=t||{},t.device=t.device||{},_.extend(c.settings,t.settings),this.initialize(),c.start(t)},_.extend(c.App.prototype,c.Events),_.extend(c.App.prototype,{initialize:function(){}}),c.App.extend=a.Model.extend,c.Touches={init:function(){var a,n,i={},s={mouse:{start:"mousedown",move:"mousemove",end:"mouseup",cancel:"mouseup"},pointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp",cancel:"MSPointerCancel"},touch:{start:"touchstart",move:"touchmove",end:"touchend",cancel:"touchcancel"}},o=30;a=c.Device.supports.pointerEvents?!1:c.Device.supports.touchEvents?!0:!1,n=c.Device.supports.pointerEvents?"pointer":c.Device.supports.touchEvents?"touch":"mouse";var r=function(t){return"tagName"in t?t:t.parentNode},l=function(t,e,a,n){var i=Math.abs(t-e),s=Math.abs(a-n);return i>=s?t-e>0?"Left":"Right":a-n>0?"Up":"Down"},d=function(){i={}};e(document).ready(function(){var c,p;e(document.body).bind(s[n].start,function(t){c=Date.now(),p=c-(i.last||c),i.el=e(r(a?t.originalEvent.targetTouches[0].target:t.target)),i.x1=a?t.originalEvent.targetTouches[0].pageX:t.pageX,i.y1=a?t.originalEvent.targetTouches[0].pageY:t.pageY,i.last=c}).bind(s[n].move,function(t){i.x2=a?t.originalEvent.targetTouches[0].pageX:t.pageX,i.y2=a?t.originalEvent.targetTouches[0].pageY:t.pageY,Math.abs(i.x1-i.x2)>10&&t.preventDefault()}).bind(s[n].end,function(){i.x2&&Math.abs(i.x1-i.x2)>o||i.y2&&Math.abs(i.y1-i.y2)>o?(i.direction=l(i.x1,i.x2,i.y1,i.y2),i.el.trigger("swipe"),i.el.trigger("swipe"+i.direction),i={}):"last"in i&&(i.el.trigger("tap"),e(document.body).unbind("click"),i.el.unbind("click"))}),e(t).bind("scroll",d)}),["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","tap"].forEach(function(t){e.fn[t]=function(e){return this.bind(t,e)}})}},c.Router=null,c.RouterClass=a.Router,_.extend(c.RouterClass.prototype,{start:function(){this.bindAnyRoute(),c.history.start(),c.trigger("ui:enhance",e("body"))},bindAnyRoute:function(){this.on("route",function(){console.log("XF.Router :: route: ",this.getPageNameFromFragment(c.history.fragment)),c.Pages&&c.Pages.show(this.getPageNameFromFragment(c.history.fragment))})},getPageNameFromFragment:function(t){var e=t.replace(/^\/+/,"").replace(/\/+$/,"").split("/");return e[0]}}),c.Utils={},c.Utils.AddressBar={},_.extend(c.Utils.AddressBar,{BODY_SCROLL_TOP:!1,getScrollTop:function(){var e=t,a=document;return e.pageYOffset||"CSS1Compat"===a.compatMode&&a.documentElement.scrollTop||a.body.scrollTop||0},hide:function(){console.log("XF :: Utils :: AddressBar :: hide");var e=t;if(location.hash||c.Utils.AddressBar.BODY_SCROLL_TOP===!1||e.scrollTo(0,1===c.Utils.AddressBar.BODY_SCROLL_TOP?0:1),c.Device.isMobile){var a=document.documentElement.style;return a.height="200%",a.overflow="visible",t.scrollTo(0,1),a.height=t.innerHeight+"px",!0}},hideOnLoad:function(){console.log("XF :: Utils :: AddressBar :: hideOnLoad");var e=t,a=e.document;!location.hash&&e.addEventListener&&(t.scrollTo(0,1),c.Utils.AddressBar.BODY_SCROLL_TOP=1,bodycheck=setInterval(function(){a.body&&(clearInterval(bodycheck),c.Utils.AddressBar.BODY_SCROLL_TOP=c.Utils.AddressBar.getScrollTop())},15),e.addEventListener("load",function(){setTimeout(function(){20>c.Utils.AddressBar.getScrollTop()},0)}))}}),c.Pages={pageClass:"xf-page",activePageClass:"xf-page-active",animations:{standardAnimation:"slideleft",next:null,types:{none:{fallback:function(){}},fade:{fallback:function(){}},slideleft:{fallback:function(){}},slideright:{fallback:function(){}}}},activePage:null,activePageName:"",init:function(t){c.on("pages:show",_.bind(c.Pages.show,c.Pages)),c.on("pages:animation:next",_.bind(c.Pages.setNextAnimationType,c.Pages)),c.on("pages:animation:default",_.bind(c.Pages.setDefaultAnimationType,c.Pages)),c.on("pages:start",_.bind(c.Pages.start,c.Pages)),_.has(t,"types")&&_.extend(this.animations.types,t.types),_.has(t,"standardAnimation")&&this.setDefaultAnimationType(t.standardAnimation),this.start()},start:function(t){t=t||e("body"),console.log("pages start",t);var a=t.find(" ."+this.pageClass);if(a.length){var n=a.filter("."+this.activePageClass);n.length?(this.activePage=n,this.activePageName=n.attr("id")):this.show(a.first())}},setDefaultAnimationType:function(t){c.Pages.animations.types[t]&&(c.Pages.animations.standardAnimation=t)},setNextAnimationType:function(t){c.Pages.animations.types[t]&&(c.Pages.animations.next=t)},show:function(t,a){if(t!==this.activePageName){if(""===t){var n=d.find(" ."+this.pageClass);return n.length&&this.show(n.first()),void 0}var i=t instanceof e?t:e("."+c.Pages.pageClass+"#"+t);if((!this.activePage||i.attr("id")!=this.activePage.attr("id"))&&i.length){console.log("XF.Pages :: showing page",i.attr("id"));var s=c.Device.getViewport();c.Device.getScreenHeight(),this.animations.next?(a=this.animations.types[this.animations.next]?this.animations.next:this.animations.standardAnimation,this.animations.next=null):a=this.animations.types[a]?a:this.animations.standardAnimation;var o=this.activePage,r=i;if(this.activePage=r,this.activePageName=i.attr("id"),!c.Device.supports.cssAnimations&&_.isFunction(this.animations.types[a].fallback))return r.addClass(this.activePageClass),this.animations.types[a].fallback(o,r),void 0;o?(s.addClass("xf-viewport-transitioning"),o.height(s.height()).addClass("out "+a),r.height(s.height()).addClass("in "+a+" "+this.activePageClass),o.animationEnd(function(){o.height("").removeClass(a+" out in"),o.removeClass(c.Pages.activePageClass)}),r.animationEnd(function(){r.height("").removeClass(a+" out in"),s.removeClass("xf-viewport-transitioning")})):this.activePage.addClass(this.activePageClass),c.trigger("ui:enhance",e(this.activePage)),f(this.activePage[0])}}}},c.UI={},_.extend(c.UI,{init:function(){c.on("ui:enhance",_.bind(c.UI.enhance,c.UI))},enhance:function(t){!t instanceof e&&(t=e(t),!t instanceof e)||_.each(c.UI,function(a){"object"==typeof a&&a.hasOwnProperty("selector")&&t.find(a.selector).not("[data-skip-enhance=true]").each(function(){var t=!1;if(_.each(c.UI.enhanced.length,function(){c.UI.enhanced[i]===this&&(t=!0)}),!t&"true"!=e(this).attr("data-skip-enhance")){var n=e(this).data();c.UI.enhanced.push(this),a.render(this,n)}})})},enhanced:[],issetElements:[],checkInIsset:function(t,e){t=t||"",e=e||"";var a=[];for(var n in this.issetElements)""===e?this.issetElements[n].type===t&&a.push(this.issetElements[n].id):this.issetElements[n].type===t&&this.issetElements[n].id===e&&a.push(this.issetElements[n].id);return a},removeFromIsset:function(t,e){t=t||"",e=e||"";var a=[];for(var n in this.issetElements)""===e?this.issetElements[n].type!==t&&a.push(this.issetElements[n]):this.issetElements[n].type!==t&&this.issetElements[n].id!==e&&a.push(this.issetElements[n]);this.issetElements=a}}),c.settings={appVersion:"1.0.0",noCache:!1,componentUrlPrefix:"js/components/",componentUrlPostfix:".js",componentUrl:function(t){return c.settings.property("componentUrlPrefix")+t+c.settings.property("componentUrlPostfix")},templateUrlPrefix:"tmpl/",templateUrlPostfix:".tmpl",dataUrlPrefix:"",ajaxSettings:{},property:function(t,e){return void 0===e?this[t]:(this[t]=e,void 0)}},c.storage={storage:null,available:!1,init:function(){this.storage=t.localStorage;try{this.storage.setItem("check","check"),this.storage.removeItem("check"),this.available=!0}catch(e){this.available=!1}var a=this.get("appVersion");c.settings.property("noCache")?(console.log("XF.storage :: init - cache is disable for the whole app manually - clearing storage"),this.clear(),this.set("appVersion",c.settings.property("appVersion"))):a&&a==c.settings.property("appVersion")?console.log("XF.storage :: init - same version is cached - useing it as much as possible"):(console.log("XF.storage :: init - wrong or no version cached - clearing storage"),this.clear(),this.set("appVersion",c.settings.property("appVersion")))},get:function(t){var e;if(this.available)try{e=this.storage.getItem(t),console.log('XF.storage :: get - "'+t+'" = "'+e+'"')}catch(a){e=null}else e=null;return e},set:function(t,e){var a;if(this.available)try{this.storage.setItem(t,e),a=!0,console.log('XF.storage :: set - "'+t+'" = "'+e+'"')}catch(n){a=!1}else a=!1;return a},clear:function(){var t;if(this.available)try{this.storage.clear(),t=!0,console.log("XF.storage :: clear")}catch(e){t=!1}else t=!1;return t}},c.Device={size:{width:0,height:0},isMobile:/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino|1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test((navigator.userAgent||navigator.vendor||t.opera).toLowerCase()),isIOS:/iphone|ipod|ipad/i.test((navigator.userAgent||navigator.vendor||t.opera).toLowerCase()),types:[{name:"desktop",range:{max:null,min:1025},templatePath:"desktop/",fallBackTo:"tablet"},{name:"tablet",range:{max:1024,min:480},templatePath:"tablet/",fallBackTo:"mobile"},{name:"mobile",range:{max:480,min:null},templatePath:"mobile/",fallBackTo:"default"}],defaultType:{name:"default",range:{min:null,max:null},templatePath:"",fallBackTo:null},type:this.defaultType,init:function(t){this.types=t||this.types,this.detectType(),this.detectTouchable()},supports:{touchEvents:!1,pointerEvents:t.navigator.msPointerEnabled,cssAnimations:function(){var t="Webkit Moz O ms Khtml".split(" "),e=document.createElement("div");if(e.style.animationName)return{prefix:""};for(var a=0;t.length>a;a++)if(void 0!==e.style[t[a]+"AnimationName"])return{prefix:"-"+t[a].toLowerCase()+"-"};return!1}()},detectType:function(){this.size.width=e(t).width(),this.size.height=e(t).height(),console.log('XF.DeviceClass :: detectType - width = "'+this.size.width+'"'),console.log('XF.DeviceClass :: detectType - height = "'+this.size.height+'"');var a=Math.max(this.size.width,this.size.height);console.log('XF.DeviceClass :: detectType - maxSide = "'+a+'"');var n=null;_.each(this.types,function(t){try{(!t.range.min||t.range.min&&a>t.range.min)&&(!t.range.max||t.range.max&&t.range.max>a)&&(n=t)}catch(e){console.log("XF.DeviceClass :: detectType - bad type detected - skipping"),console.log("XF.DeviceClass :: detectType - @dev: plz verify types list")}}),n?this.type=n:(this.type=this.defaultType,console.log("XF.DeviceClass :: detectType - could not choose any of device type"),console.log("XF.DeviceClass :: detectType - drop back to this.defaultType"),console.log("XF.DeviceClass :: detectType - @dev: plz verify types list")),console.log('XF.DeviceClass :: detectType - selected type "'+this.type.name+'"')},getTypeByName:function(t){var e=null;return _.each(this.types,function(a){try{a.name==t&&(e=a)}catch(n){console.log("XF.DeviceClass :: getTypeByName - bad type name - skipping"),console.log("XF.DeviceClass :: getTypeByName - @dev: plz verify types list")}}),e},detectTouchable:function(){var e=" -webkit- -moz- -o- -ms- ".split(" "),a=["@media (",e.join("touch-enabled),("),"app_device_test",")","{#touch{top:9px;position:absolute}}"].join(""),n=this;this.injectElementWithStyles(a,function(e){var a=document.styleSheets[document.styleSheets.length-1],i=(a?a.cssRules&&a.cssRules[0]?a.cssRules[0].cssText:a.cssText||"":"",e.childNodes),s=i[0];n.supports.touchEvents="ontouchstart"in t||t.DocumentTouch&&document instanceof DocumentTouch||9===(s&&s.offsetTop)},1,["touch"]),console.log("XF.Device :: detectTouchable - device IS "+(this.supports.touchEvents?"":"NOT ")+"touchable")},injectElementWithStyles:function(t,e,a,n){var i,s,o,r=document.createElement("div"),l=document.body,d=l?l:document.createElement("body");if(parseInt(a,10))for(;a--;)o=document.createElement("div"),o.id=n?n[a]:"app_device_test"+(a+1),r.appendChild(o);return i=["&#173;","<style>",t,"</style>"].join(""),r.id="app_device_test",d.innerHTML+=i,d.appendChild(r),l||(d.style.background="",docElement.appendChild(d)),s=e(r,t),l?r.parentNode.removeChild(r):d.parentNode.removeChild(d),!!s},ORIENTATION_PORTRAIT:"portrait",ORIENTATION_LANDSCAPE:"landscape",getOrientation:function(){var t=!0,a=document.documentElement;return void 0!==e.support||(t=a&&1.1>a.clientWidth/a.clientHeight),t?this.ORIENTATION_PORTRAIT:this.ORIENTATION_LANDSCAPE},getScreenHeight:function(){var a=this.getOrientation(),n=a===this.ORIENTATION_PORTRAIT,i=n?480:320,s=n?screen.availHeight:screen.availWidth,o=Math.max(i,e(t).height()),r=Math.min(s,o);return r},getViewport:function(){var t=e("body").addClass("xf-viewport");return t[0]||(t=e(".xf-page").eq(0),t=t.length?t.parent():e("body"),t.addClass("xf-viewport")),t.eq(0)}},c.Collection=a.Collection.extend({component:null,root:null,status:{loaded:!1,loading:!1,loadingFailed:!1},ajaxSettings:null,_bindListeners:function(){},constructor:function(t,n){if(this._bindListeners(),this.component=n.component,this.url=this.url||c.settings.property("dataUrlPrefix").replace(/(\/$)/g,"")+"/"+this.component.name+"/",this.component.options.updateOnShow&&e(this.component.selector()).bind("show",_.bind(this.refresh,this)),this.ajaxSettings=this.ajaxSettings||c.settings.property("ajaxSettings"),_.has(this.ajaxSettings,"success")&&_.isFunction(this.ajaxSettings.success)){var i=this.ajaxSettings.success,s=_.bind(this._onDataLoaded,this);this.ajaxSettings.success=function(){s(),i()}}else this.ajaxSettings.success=_.bind(this._onDataLoaded,this);a.Collection.apply(this,arguments)},initialize:function(){},construct:function(){},refresh:function(){this.status.loaded=!1,this.status.loading=!0,this.fetch(this.ajaxSettings)},_onDataLoaded:function(){console.log("data loaded"),this.status.loaded=!0,this.status.loading=!1,this.trigger("fetched")}}),c.Model=a.Model.extend({component:null,root:null,status:{loaded:!1,loading:!1,loadingFailed:!1},ajaxSettings:null,_bindListeners:function(){},constructor:function(t,n){if(this.component=n.component,this._bindListeners(),this.urlRoot=this.urlRoot||c.settings.property("dataUrlPrefix").replace(/(\/$)/g,"")+"/"+this.component.name+"/",this.component.options.updateOnShow&&e(this.component.selector()).bind("show",_.bind(this.refresh,this)),this.ajaxSettings=this.ajaxSettings||c.settings.property("ajaxSettings"),_.has(this.ajaxSettings,"success")&&_.isFunction(this.ajaxSettings.success)){var i=this.ajaxSettings.success,s=_.bind(this._onDataLoaded,this);this.ajaxSettings.success=function(){s(),i()}}else this.ajaxSettings.success=_.bind(this._onDataLoaded,this);a.Model.apply(this,arguments)},initialize:function(){},construct:function(){},refresh:function(){this.status.loaded=!1,this.status.loading=!0,this.fetch(this.ajaxSettings)},_onDataLoaded:function(){this.status.loaded=!0,this.status.loading=!1,this.trigger("fetched")}}),c.View=a.View.extend({component:null,status:{loaded:!1,loading:!1,loadingFailed:!1},template:{src:null,compiled:null,cache:!0},url:function(){return c.settings.property("templateUrlPrefix")+c.Device.type.templatePath+this.component.name+c.settings.property("templateUrlPostfix")},_bindListeners:function(){this.component.options.autorender&&(this.component.collection?this.listenTo(this.component.collection,"fetched",this.refresh):this.model&&this.listenTo(this.component.model,"fetched",this.refresh)),this.on("refresh",this.refresh,this)},constructor:function(t){this.setElement("[data-id="+t.attributes["data-id"]+"]"),this.component=t.component,_.omit(t,"component"),this._bindListeners(),this.load(),a.View.apply(this,arguments)},initialize:function(){},construct:function(){},load:function(){if(!this.template.src){var t=_.isFunction(this.url)?this.url():this.url;if(!t)return this.status.loadingFailed=!0,this.trigger("loaded"),void 0;if(this.template.cache&&_.has(c,"storage")){var a=c.storage.get(t);if(a)return this.template.src=a,this.status.loaded=!0,this.trigger("loaded"),void 0}if(!this.status.loaded&&!this.status.loading){this.status.loading=!0;var n=this;e.ajax({url:t,complete:function(e,a){if(!n.component)throw'XF.View "component" linkage lost';if("success"==a){var i=e.responseText;n.template.cache&&_.has(c,"storage")&&c.storage.set(t,i),n.template.src=e.responseText,n.status.loading=!1,n.status.loaded=!0,n.afterLoadTemplate(),n.trigger("loaded")}else n.template.src=null,n.status.loading=!1,n.status.loaded=!1,n.status.loadingFailed=!0,n.afterLoadTemplateFailed(),n.trigger("loaded")}})}}},getMarkup:function(){var t={collection:null,model:null};return this.template.compiled||(this.template.compiled=_.template(this.template.src)),this.component.collection?t.collection=this.component.collection.toJSON():this.component.model&&(t.model=this.component.model.toJSON()),this.template.compiled(t)},beforeLoadTemplate:function(){},afterLoadTemplate:function(){},afterLoadTemplateFailed:function(){console.log('XF.View :: afterLoadTemplateFailed - could not load template for "'+this.component.id+'"'),console.log("XF.View :: afterLoadTemplateFailed - @dev: verify XF.Device.types settings & XF.View :: getTemplate URL overrides")},refresh:function(){this.status.loaded&&this.template.src&&(!this.component.collection&&!this.component.model||this.component.collection&&this.component.collection.status.loaded||this.component.model&&this.component.model.status.loaded)&&(console.log("VIEW ReFRESH"),this.beforeRender(),this.render(),this.afterRender())},beforeRender:function(){},renderVersion:0,render:function(){return this.$el.html(this.getMarkup()),c.trigger("ui:enhance",this.$el),this.renderVersion++,this.trigger("rendered"),this},afterRender:function(){}}),c.Component=function(t,e){this.name=t||"default_name",this.id=e||"default_id",this.options=_.defaults(c.getOptionsByID(this.id),this.options,this.defaults),this.initialize()},_.extend(c.Component.prototype,c.Events),_.extend(c.Component.prototype,{defaults:{autoload:!0,autorender:!0,updateOnShow:!1},options:{},selector:function(){return"[data-id="+this.id+"]"},Model:c.Model,model:null,Collection:c.Collection,collection:null,View:c.View,view:null,_bindListeners:function(){this.on("component:"+this.id+":refresh",_.bind(this.refresh,this))},construct:function(){},initialize:function(){if(this.Collection?(this.collection=new this.Collection({},{component:this}),this.collection.construct()):this.Model&&(this.model=new this.Model({},{component:this}),this.model.construct()),this.View){var t={attributes:{"data-id":this.id},component:this};this.collection?t.collection=this.collection:this.model&&(t.model=this.model),this.view=new this.View(t),this.view.construct()}this._bindListeners(),this.construct(),this.view.listenToOnce(this.view,"loaded",this.view.refresh),this.collection&&this.options.autoload?this.collection.refresh():this.model&&this.options.autoload?this.model.refresh():this.view&&this.view.refresh()},refresh:function(){this.collection&&!this.collection.status.loading?this.collection.refresh():this.model&&!this.model.status.loading&&this.model.refresh(),this.view&&!this.view.status.loading&&this.view.refresh()}}),c.Component.extend=a.Model.extend;var C=function(t){this.compSrc=t,this.compDef=null,this.loading=!1,this.loaded=!1,this.callbacks=[]};c.UI.button={selector:"A[data-role=button], BUTTON, INPUT[type=submit], INPUT[type=reset], INPUT[type=button], [data-appearance=backbtn]",render:function(t,a){var n,i,s=e(t);if(t&&!(!s instanceof e)&&"true"!=s.attr("data-skip-enhance")){if("A"==t.nodeName||"BUTTON"==t.nodeName)n=s.attr({"data-skip-enhance":!0}),i=s.html(),s.html("");else{if("INPUT"!=t.nodeName)return;n=e("<div></div>").append(s.clone().addClass("xf-input-hidden").attr({"data-skip-enhance":!0})),s.outerHtml(n),i=s.attr("value")}var o=a.small===!0||"backbtn"==a.appearance,r=a.position||"";""!==r&&n.addClass("xf-button-float-"+r),s.parents(c.UI.header.selector).length>0&&n.addClass("xf-button-header-"+r),n.addClass(o?"xf-button-small":"xf-button"),"backbtn"===a.appearance&&n.addClass("xf-button-back");var l=a.icon;if("backbtn"===a.appearance&&(l="left"),l){var d=e("<span class=xf-icon></span>");d.addClass("xf-icon-"+l),o?d.addClass("xf-icon-small"):d.addClass("xf-icon-big");var p=a.iconpos||"left";"left"!=p&&"right"!=p&&"top"!=p&&"bottom"!=p&&(p="left"),n.addClass("xf-iconpos-"+p),n.append(d)}if(i){var h=e("<span></span>").append(i);o||"backbtn"==a.appearance?h.addClass("xf-button-small-text"):h.addClass("xf-button-text"),n.append(h)}else o&&n.addClass("xf-button-small-icon-only");1==a.special&&n.addClass("xf-button-special"),1==a.alert&&n.addClass("xf-button-alert")}}},c.UI.checkboxRadio={selector:"INPUT[type=checkbox], INPUT[type=radio]",render:function(t,a){var n=e(t),a={id:"",input:"",wrapperClass:"",labelClass:"",labelFor:"",isSwitch:!1,label:""};if(t&&!(!n instanceof e)&&"true"!=n.attr("data-skip-enhance")){n.attr({"data-skip-enhance":!0}),a.id=n.attr("id")||"xf-"+Math.floor(1e4*Math.random()),a.input=n.wrap("<span></span>").parent().html(),n.attr("id",a.id);var i=e("label[for="+a.id+"]");if(i.length){var s=n.attr("type").toLowerCase(),o=e("<div></div>"),r=a.isSwitch="switch"==n.attr("data-role");r?(a.wrapperClass="xf-switch",a.labelClass="xf-switch-control",i.addClass("xf-switch-label")):(a.wrapperClass="xf-input-"+s,a.labelClass="xf-input-positioner",i.addClass("xf-input-label")),o.append(i),a.labelFor=i.wrap("<span></span>").parent().html();var l=_.template('<div class="<%= options.wrapperClass %>"><label for="<%= options.id %>" class="<%= options.labelClass %>"><%= options.input %><% if(options.isSwitch) { %><span class=xf-switch-track><span class=xf-switch-track-wrap><span class=xf-switch-thumb></span></span></span><% } %></label><%= options.labelFor %></div>');n.parent().html(l({options:a}))}}}},c.UI.fieldset={selector:"fieldset[data-role=controlgroup]",render:function(t){var a=e(t);if(t&&!(!a instanceof e)&&"true"!=a.attr("data-skip-enhance")){var n=a.attr("id")||"xf-"+Math.floor(1e4*Math.random());a.attr({"data-skip-enhance":!0,id:n}),a.addClass("xf-controlgroup");var i=a.children("legend").detach();if(a.wrapInner('<div class="xf-controlgroup-controls">'),a.prepend(i),i.length){var s=e("<div></div>"),o={};_.each(i[0].attributes,function(t){o[t.name]=t.value}),s.attr(o).addClass("xf-label").html(i.html()),i.outerHtml(s.outerHtml())}}}},c.UI.footer={selector:"footer, [data-role=footer]",render:function(t,a){var n=e(t);if(t&&!(!n instanceof e)&&"true"!=n.attr("data-skip-enhance")){if(a.id=a.id||"xf-footer-component-"+Math.floor(1e4*Math.random()),n.attr({"data-id":a.id,id:a.id,"data-role":"footer","data-skip-enhance":"true"}),a.fixed=a.fixed===!0?!0:!1,a.buttons=a.buttons||[],a.fixed){var i=e(this.selector).parents(".xf-page");i[0]?i.addClass("xf-page-has-fixed-footer"):c.Device.getViewport().addClass("xf-viewport-has-fixed-footer")}var s=n.find(c.UI.button.selector);a.buttonsClass="xf-grid-unit-1of"+s.length;for(var o=0;s.length>o;++o){var r=s.eq(o),l={iconClass:r.attr("data-icon")?"xf-icon-"+r.attr("data-icon"):"",dataHrefString:r.attr("data-href")?r.attr("data-href"):"",textClass:r.attr("data-text-class")?r.attr("data-text-class"):"",id:r.attr("data-id")?r.attr("data-id"):a.id+"-item"+o,text:r.val()||r.text()||""};a.buttons.push(l)}c.Router.on("route",function(){c.UI.footer.selectButton(n)});var d=_.template('<div class="xf-footer <% if(fixed) { %> xf-footer-fixed <% } %>"><ul class="xf-nav"><% _.each(buttons, function(button) { %><li class="xf-grid-unit <%= buttonsClass %>"><a data-href="<%= button.dataHrefString %>" class="xf-nav-item xf-iconpos-top" id="<%= button.id %>"><div class="xf-icon xf-icon-big <%= button.iconClass %>"></div><div class="xf-nav-item-text <%= button.textClass %>"><%= button.text %></div></a></li><% }); %></ul></div>');n.html(d(a)),c.UI.footer.selectButton(n)}},selectButton:function(t){var e=c.history.fragment;t.find(".xf-nav a").removeClass("xf-nav-item-active"),t.find('.xf-nav a[data-href="#'+e+'"]').addClass("xf-nav-item-active")}},c.UI.header={selector:"[data-role=header]",render:function(t,a){var n=e(t);if(t&&!(!n instanceof e)&&"true"!=n.attr("data-skip-enhance")){var i=n.find("h1");i.length>0&&i.addClass("xf-header-title"),a.id=a.id||"xf-header-component-"+Math.floor(1e4*Math.random()),a.title=a.title||"",a.html=n.html(),a.isFixed=a.fixed&&a.fixed===!0?!0:!1,n.attr({"data-id":a.id,id:a.id,"data-skip-enhance":"true"});var s=_.template('<header class="xf-header <% if(isFixed) { %> xf-header-fixed <% } %>"><%= html %></header>');n.html(s(a))}}},c.UI.list={selector:"UL[data-role=listview], OL[data-role=listview]",render:function(t,a){var n=e(t);if(t&&!(!n instanceof e)&&"true"!=n.attr("data-skip-enhance")){var i=n.children("li"),s=i.children("a"),o=[],r=a.fullwidth||"false",l=n.attr("id")||"xf-"+Math.floor(1e4*Math.random());s.addClass("xf-li-btn").children(".xf-count-bubble").parent().addClass("xf-li-has-count"),i.not(s.parent()).not("[data-role=divider]").addClass("xf-li-static"),n.attr({"data-skip-enhance":!0,id:l}).addClass("xf-listview").children("li[data-icon]").children("a").each(function(){var t=e(this),a=t.parent().attr("data-icon");t.append(e("<span></span>").addClass("xf-icon xf-icon-big xf-icon-"+a));var n=t.parent().attr("data-iconpos");"left"!=n&&"right"!=n&&(n="right"),t.addClass("xf-li-with-icon-"+n)}),"true"===r&&n.addClass("xf-listview-fullwidth"),s.children("img").parent().each(function(){var t=e(this),a=t.parent().attr("data-thumbpos");"right"!=a&&"left"!=a&&(a="left"),t.addClass("xf-li-with-thumb-"+a),t.children("img").addClass("xf-li-thumb xf-li-thumb-"+a)}),s.each(function(){var t=e(this);t.append(e("<div class=xf-btn-text></div>").append(t.children().not(".xf-icon, .xf-count-bubble, .xf-li-thumb")))}),i.find("h1, h2, h3, h4, h5, h6").addClass("xf-li-header"),i.find("p").addClass("xf-li-desc"),i.filter(".xf-li-static").each(function(){e(this).wrapInner("<div class=xf-li-wrap />")}),e.each(i,function(t){var e=i.eq(t).html(),a=i.eq(t).attr("data-role")||"",n=(i.eq(t).attr("class")||"")+" xf-li",s=i.eq(t).attr("id")||"";""!==a&&(n+=" xf-li-"+a),o.push({html:e,"class":n,id:s})});var d=_.template('<% _.each(listItemsScope, function(item) { %> <li class="<%= item.class %>" id="<%= item.id %>"><%= item.html %></li><% }); %>');n.html(d({listItemsScope:o}))}}},c.UI.loader={selector:"[data-role=loader]",render:function(t,a){var n=e(t);if(t&&!(!n instanceof e)&&"true"!=n.attr("data-skip-enhance")){var i=n.attr("id")||"xf-"+Math.floor(1e4*Math.random()),s=c.UI.checkInIsset("loader"),o=!1;for(var r in s)o&&(e("#"+s[r]).length||(i=s[r],o=!0));return o||c.UI.issetElements.push({type:"loader",id:i}),n.attr({id:i,"data-skip-enhance":"true"}),e("#"+i).hasClass("xf-loader")||e("#"+i).addClass("xf-loader"),n}},show:function(t){t=t||this.create(),t.show()
},hide:function(t){t.hide()},remove:function(t){t.detach(),c.UI.removeFromIsset("popup",t.attr("id"))},create:function(){var t=e('<div class="xf-loader" data-role="loader"></div>');return c.Device.getViewport().append(t),this.render(t[0])}},c.UI.popup={render:function(){var t="xf-"+Math.floor(1e4*Math.random()),a=c.UI.checkInIsset("popup"),n=!1;for(var i in a)n&&(e("#"+a[i]).length||(t=a[i],n=!0));n||c.UI.issetElements.push({type:"popup",id:t});var s=e('<div class="xf-dialog " id="'+t+'"><div class="xf-dialog-content"></div></div>');return s},showDialog:function(t,e,a){var n=this.createDialog(t,e,a);this.show(n)},show:function(t){c.Device.getViewport().append(t)},hide:function(t){t.detach(),c.UI.removeFromIsset("popup",t.attr("id"))},createDialog:function(t,a,n){n=n||[];var i=this.render(),s=_.template('<div class="xf-dialog-box"><div class="xf-dialog-box-header"><h3><%= headerText %></h3></div><div class="xf-dialog-box-content"><%= messageText %></div><div class="xf-dialog-box-footer clearfix"></div></div>');i.find(".xf-dialog-content").html(s({headerText:t,messageText:a}));var o=i.find(".xf-dialog-box-footer");if(1>n.length&&n.push({text:"OK",handler:function(){c.UI.popup.hide(i)}}),n.length>0){var r,l=n.length;_.each(n,function(t){r=t instanceof e?t:c.UI.popup.createButton(t),o.append(e("<div></div>").addClass("xf-grid-unit xf-grid-unit-1of"+l).append(r))})}return this.dialog=i,c.trigger("ui:enhance",i),i},createNotification:function(t,a){var n=this.render().addClass("xf-dialog-notification"),i=_.template('<div class="xf-notification"><div class="xf-notification-wrap"><div class="xf-notification-text"><%= messageText %></div></div></div>');return n.find(".xf-dialog-content").html(i({messageText:t})),a&&""!=a&&n.find(".xf-notification-wrap").prepend(e("<div></div>").addClass("xf-notification-icon").append(e("<span></span>").addClass("xf-icon xf-icon-xl xf-icon-"+a))),n},dialog:null,hideDialog:function(){this.dialog&&this.hide(this.dialog)},hideAll:function(){var t=c.UI.checkInIsset("popup");for(var a in t)e("#"+t[a]).length&&this.hide(e("#"+t[a]))},createButton:function(t){var a=e("<button></button>"),n={};return n.id=t.id||"xf-"+Math.floor(1e4*Math.random()),n["class"]=t.class||"",n.name=t.name||n.id,t.small=t.small||"",a.html(t.text),t.icon&&""!=t.icon&&(n["data-icon"]=t.icon),t.iconpos&&""!=t.iconpos&&(n["data-iconpos"]=t.iconpos),t.small&&""!=t.small&&(n["data-small"]=t.small),t.appearance&&""!=t.appearance&&(n["data-appearance"]=t.appearance),t.special&&""!=t.special&&(n["data-special"]=t.special),t.alert&&""!=t.alert&&(n["data-alert"]=t.alert),_.isFunction(t.handler)&&a.click(t.handler),a.attr(n),_.isFunction(t.handler)&&a.on("tap",t.handler),a}},c.UI.scrollable={selector:"[data-scrollable=true]",render:function(t){var a=e(t);if(t&&!(!a instanceof e)&&"true"!=a.attr("data-skip-enhance")){var n=a.attr("id")||"xf-"+Math.floor(1e4*Math.random());a.attr({"data-skip-enhance":!0,id:n});var i=a.children();a.append(e("<div></div>").addClass("xf-scrollable-content").append(i));var s=a.attr("id");s&&""!=s||(s="xf_scrollable_"+(new Date).getTime(),a.attr({id:s}));var o=a.data("iscroll",new iScroll(s)),r=!1,l=function(){r&&(r=!1,o.data("iscroll").refresh(),c())},d=function(){e.contains(e("#"+s)[0],this)&&(r=!0,setTimeout(l,100))},c=function(){e("#"+s+" *").bind("detach",d).bind("hide",d).bind("show",d).bind("append",d).bind("prepend",d).bind("html",d).bind("resize",d)};c()}}},c.UI.slidemenu={selector:"[data-role=slidemenu]",render:function(t,a){var n=e(t);if(t&&!(!n instanceof e)&&"true"!=n.attr("data-skip-enhance")){a.id=a.id||"xf-slidemenu-component-"+Math.floor(1e4*Math.random()),a.title=a.title||"",a.hasTitle=""!=a.title?!0:!1,a.isFixed=a.fixed&&a.fixed===!0?!0:!1,a.buttons=a.buttons||[],a.html=n.html(),n.attr({"data-id":a.id,id:a.id,"data-skip-enhance":"true"}).addClass("xf-slidemenu-wrapper");var i='<button class="xf-slidemenu-button xf-button-float-'+n.data("button-position")+" xf-button-header-"+n.data("button-position")+' xf-button-small-icon-only xf-button-small xf-button" data-position="'+n.data("button-position")+'" data-skip-enhance="true"><span class="xf-icon xf-icon-list xf-icon-small"></span></button>',s=e("#"+n.data("button-container"));s.find("header").append(i),a.menuButton='<button class="xf-slidemenu-close-button xf-button-float-'+n.data("button-position")+" xf-button-header-"+n.data("button-position")+' xf-button-small-icon-only xf-button-small xf-button" data-position="'+n.data("button-position")+'" data-skip-enhance="true"><span class="xf-icon xf-icon-cross xf-icon-small"></span</button>';var o=n.find(c.UI.button.selector);a.buttonsClass="";for(var r=0;o.length>r;++r){var l=o.eq(r),d={iconClass:l.attr("data-icon")?"xf-icon-"+l.attr("data-icon"):"",dataHrefString:l.attr("data-href")?l.attr("data-href"):"",textClass:l.attr("data-text-class")?l.attr("data-text-class"):"",id:l.attr("data-id")?l.attr("data-id"):a.id+"-item"+r,"class":l.attr("data-class")||"",text:l.val()||l.text()||""};a.buttons.push(d)}c.Router.on("route",function(){c.UI.slidemenu.selectButton(n),e(".xf-slidemenu-wrapper")&&(e(".xf-slidemenu-wrapper").removeClass("xf-slidemenu-show"),e("body").removeClass("blur-page"))});var p=_.template('<div class="xf-slidemenu-scrollable"><div class="xf-slidemenu-header"><%= title %><%= menuButton %></div><%= html %></div>');n.html(p(a)),c.trigger("ui:enhance",n),e(".xf-slidemenu-button").on("tap",function(){return e(".xf-slidemenu-wrapper").addClass("xf-slidemenu-show xf-slidemenu-animation"),e("body").addClass("blur-page xf-viewport-transitioning"),!1}),e(".xf-slidemenu-close-button").on("tap",function(){var t=c.Device.isIOS?300:0;return setTimeout(function(){e(".xf-slidemenu-wrapper").removeClass("xf-slidemenu-show"),e("body").removeClass("blur-page xf-viewport-transitioning")},t),!1}),this.selectButton(n)}},selectButton:function(t){var e=""!==c.history.fragment?c.history.fragment:"home";t.find("a").removeClass("xf-slidemenu-item-active"),t.find('a[data-href="#'+e+'"], a[href="#'+e+'"]').addClass("xf-slidemenu-item-active")}},c.UI.tabs={selector:"[data-role=tabs]",render:function(t,a){var n=e(t);if(t&&!(!n instanceof e)&&"true"!=n.attr("data-skip-enhance")){a.id=a.id||"xf-tabs-component-"+Math.floor(1e4*Math.random()),a.tabsperrow=a.tabsperrow||4,n.attr({"data-id":a.id,id:a.id,"data-skip-enhance":"true"}),a.tabs=a.tabs||[];var i=n.find(c.UI.button.selector);a.rowCount=Math.ceil(i.length/a.tabsperrow),a.tabsClass=a.tabsclass||"";var s=i.length%a.tabsperrow;s||(s=a.tabsperrow);for(var o=0;i.length>o;++o){var r=i.eq(o),l=o+1,d={className:""};1===l&&(d.className+=" xf-corner-tl "),(l===a.tabsperrow||1==a.rowCount&&o==i.length)&&(d.className+=" xf-corner-tr "),l==i.length+1-s&&(d.className+=" xf-corner-bl "),l===i.length&&(d.className+=" xf-corner-br "),r.attr("data-active")&&(d.className+=" xf-tabs-button-active "),d.gridClass=l>i.length-s?"xf-grid-unit-1of"+s:"xf-grid-unit-1of"+a.tabsperrow,d.id=r.attr("id")||a.id+"-item-"+o,d.text=r.val()||r.text()||"",d.params=r.attr("data-params")||"{}",a.tabs.push(d)}var p=_.template('<ul class="xf-tabs"><% _.each(tabs, function(tab) { %><li class="xf-grid-unit <%= tabsClass %> <%= tab.gridClass %>  "><a data-params="<%= tab.params %>" class="xf-tabs-button <%= tab.className %>" id="<%= tab.id %>"><span class="xf-tabs-button-text"><%= tab.text %></span></a></li><% }); %></ul>');n.html(p(a)),n.find("a").on("tap",function(){c.UI.tabs.selectTab(n,e(this))})}},selectTab:function(t,e){t.find("a").removeClass("xf-tabs-button-active"),e.addClass("xf-tabs-button-active")}},c.UI.input={selector:"INPUT[type=text], INPUT[type=search], INPUT[type=tel], INPUT[type=url], INPUT[type=email], INPUT[type=password], INPUT[type=datetime], INPUT[type=date], INPUT[type=month], INPUT[type=week], INPUT[type=time], INPUT[type=datetime-local], INPUT[type=number], INPUT[type=color], TEXTAREA, INPUT[type=range], INPUT[type=search]",render:function(t,a){var n=e(t),i={start:"mousedown touchstart MSPointerDown",move:"mousemove touchmove MSPointerMove",end:"mouseup touchend MSPointerUp"};if(t&&!(!n instanceof e)&&"true"!=n.attr("data-skip-enhance")){n.attr({"data-skip-enhance":!0}),n.addClass("xf-input-text");var s="INPUT"==t.nodeName,o=n.attr("type");if("search"==o){var r=e('<input type="text"/>'),l={};_.each(t.attributes,function(t){"type"!=t.name&&(l[t.name]=t.value)}),r.attr(l),n.outerHtml(r),n=r,t=r[0]}else if("number"==o||"range"==o){var d=n.attr("min"),p=n.attr("max"),h=parseFloat(n.attr("value")),u=parseFloat(n.attr("step"))||1,r=e('<input type="text"/>'),l={};_.each(t.attributes,function(t){"type"!=t.name&&(l[t.name]=t.value)}),r.attr(l),r.attr({"data-skip-enhance":!0});var f=e("<div></div>").addClass("xf-input-number");f.append(e('<button type="button"></button>').addClass("xf-input-number-control xf-input-number-control-decrease").attr({"data-skip-enhance":!0}).append(e("<span></span>").addClass("xf-icon xf-icon-big xf-icon-circled-minus"))),f.append(r),f.append(e('<button type="button"></button>').addClass("xf-input-number-control xf-input-number-control-increase").attr({"data-skip-enhance":!0}).append(e("<span></span>").addClass("xf-icon xf-icon-big xf-icon-circled-plus")));var m=null;if("number"==o)n.outerHtml(f),n=f,t=f[0];else if("range"==o&&(m=e("<div></div>").addClass("xf-range"),m.append(f),(d||0===d)&&(p||0===p))){d=parseFloat(d),p=parseFloat(p);var g=_.template('<div class="xf-input-range"><div class="xf-range-wrap"><div class="xf-input-range-min"><%= minValue %></div><div class="xf-input-range-slider"><div class="xf-input-range-track"><div class="xf-input-range-value" style="width: 0"><div class="xf-input-range-control" tabindex="0"><div class="xf-input-range-thumb" style="left:100%" title="<%= selValue %>"></div></div></div></div></div><div class="xf-input-range-max"><%= maxValue %></div></div></div>');m.append(g({minValue:d,maxValue:p,selValue:h})),n.outerHtml(m),n=m,t=m[0]}var v=function(t){var e=t%u,a=t-e;if(e>u/2&&(a+=u),t=a,(p||0===p)&&t>p&&(t=p),(d||0===d)&&d>t&&(t=d),h=t,r.attr({value:t}),m){m.find("div.xf-input-range-thumb").attr({title:t});var n=100*(t-d)/(p-d);m.find("div.xf-input-range-value").css({width:""+n+"%"})}},x=function(){var t=parseFloat(r.attr("value"));t+=u,v(t)},b=function(){var t=parseFloat(r.attr("value"));t-=u,v(t)};f.find("button.xf-input-number-control-decrease").on("tap",b),f.find("button.xf-input-number-control-increase").on("tap",x);var y,w=r.attr("value"),C=function(){y=r.attr("value"),w!=y&&(y=parseFloat(y),isNaN(y)&&(y=d),w=y,v(y))};if(r.change(C).focus(C).focusout(C),m){var T,k,I,P,U,E=void 0,N=function(t){return E||(E=m.find("div.xf-input-range-track")[0].clientWidth),t/E*(p-d)},D=function(t){return N(t)+d},S=function(t){I=c.Device.supports.touchEvents?t.originalEvent.targetTouches[0].pageX:t.pageX||t.clientX||layerX||t.screenX,T=h,e(document).bind(i.end,A),e(document).bind(i.move,F)},F=function(t){P=c.Device.supports.touchEvents?t.originalEvent.targetTouches[0].pageX:t.pageX||t.clientX||layerX||t.screenX,U=P-I,k=N(U),I=P,T+=k,v(T)},A=function(){e(document).bind(i.end,A),e(document).bind(i.move,F)},M=function(){e(document).bind("keydown",O)},O=function(t){switch(t.keyCode){case 33:v(h+3*u);break;case 34:v(h-3*u);break;case 35:v(p);break;case 36:v(d);break;case 38:case 39:v(h+u);break;case 37:case 40:v(h-u)}},X=function(){e(document).unbind("keydown",O)};m.find("div.xf-input-range-thumb").bind("mousedown touchstart",S),m.find("div.xf-input-range-control").bind("focus",M).bind("focusout",X);var R=function(t){t.target!=m.find("div.xf-input-range-thumb")[0]&&v(D(t.offsetX))};m.find("div.xf-input-range-track").bind("click",R)}}var L=!1;if("split"==a.appearance&&s){var B=["text","search","tel","url","email","password","datetime","date","month","week","time","datetime-local","color"];_.each(B,function(t){o==t&&(L=!0)})}var j="INPUT"===n[0].nodeName?n.attr("id"):n.find("input").eq(0).attr("id"),V=j&&j.length?e("label[for="+j+"]"):[];if(V.length)if(L){n.removeClass("xf-input-text").addClass("xf-input-split-input"),V.addClass("xf-input-split-label");var z=e("<div></div>").addClass("xf-input-split");z.append(e("<div></div>").addClass("xf-grid-unit xf-input-split-part1").append(V)),z.append(e("<div></div>").addClass("xf-grid-unit xf-input-split-part2").append(n.clone())),n.outerHtml(z),n=z,t=z[0]}else V.addClass("xf-label")}}}}).call(this,window,$,Backbone);