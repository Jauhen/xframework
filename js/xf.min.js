/*! X-Framework 01-08-2013 */
(function(t,e){var i=null,n=$.fn.hide;$.fn.hide=function(){var t=n.apply(this,arguments);return $(this).trigger("hide"),t};var o=$.fn.show;$.fn.show=function(){var t=o.apply(this,arguments);return $(this).trigger("show"),t};var s=$.fn.html;$.fn.html=function(){var t=s.apply(this,arguments);return $(this).trigger("show"),$(this).trigger("html"),t};var a=$.fn.append;$.fn.append=function(){var t=a.apply(this,arguments);return $(this).trigger("append"),t};var r=$.fn.prepend;$.fn.prepend=function(){var t=r.apply(this,arguments);return $(this).trigger("prepend"),t},$.fn.animationComplete=function(e){return"WebKitTransitionEvent"in t||"transitionEvent"in t?$(this).one("webkitAnimationEnd animationend",e):(setTimeout(e,0),$(this))},_.isFunction($.fn.detach)||($.fn.detach=function(t){return this.remove(t,!0)}),_.isFunction($.fn.wrapInner)||($.fn.wrapInner=function(t){return _.isFunction(t)?this.each(function(e){$(this).wrapInner(t.call(this,e))}):this.each(function(){var e=$(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)})});var c=$.fn.detach;$.fn.detach=function(){var t=$(this).parent(),e=c.apply(this,arguments);return t.trigger("detach"),e},XF=t.XF=t.XF||{},XF.Events=e.Events,_.extend(XF,XF.Events),XF.navigate=function(t){XF.Router.navigate(t,{trigger:!0})},XF.on("navigate",XF.navigate),XF.start=function(t){t=t||{},XF.Cache=new XF.CacheClass,_.extend(XF.Settings.options,t.settings),XF.Cache.init(),t.device=t.device||{},XF.Device.init(t.device.types),t.router=t.router||{},h(t.router),l(),p(),XF.Router.start(),i=t.root,i||(i=$("body")),XF.Pages.start(),u(i)},XF.Utils={},XF.Utils.AddressBar={},_.extend(XF.Utils.AddressBar,{BODY_SCROLL_TOP:!1,getScrollTop:function(){var e=t,i=document;return e.pageYOffset||"CSS1Compat"===i.compatMode&&i.documentElement.scrollTop||i.body.scrollTop||0},hide:function(){console.log("XF :: Utils :: AddressBar :: hide");var e=t;if(location.hash||XF.Utils.AddressBar.BODY_SCROLL_TOP===!1||e.scrollTo(0,1===XF.Utils.AddressBar.BODY_SCROLL_TOP?0:1),XF.Device.isMobile){var i=document.documentElement.style;return i.height="200%",i.overflow="visible",t.scrollTo(0,1),i.height=t.innerHeight+"px",!0}},hideOnLoad:function(){console.log("XF :: Utils :: AddressBar :: hideOnLoad");var e=t,i=e.document;!location.hash&&e.addEventListener&&(t.scrollTo(0,1),XF.Utils.AddressBar.BODY_SCROLL_TOP=1,bodycheck=setInterval(function(){i.body&&(clearInterval(bodycheck),XF.Utils.AddressBar.BODY_SCROLL_TOP=XF.Utils.AddressBar.getScrollTop(),XF.Utils.AddressBar.hide())},15),e.addEventListener("load",function(){setTimeout(function(){20>XF.Utils.AddressBar.getScrollTop()&&XF.Utils.AddressBar.hide()},0)}))}});var h=function(t){if(XF.Router)throw"XF.createRouter can be called only ONCE!";XF.Router=new(XF.RouterClass.extend(t))},l=function(){$("body").on("click","[data-href]",function(){XF.Router.navigate($(this).attr("data-href"),{trigger:!0}),_.delay(function(){t.scrollTo(0,0)},250)})},u=function(t){$(t).find("[data-component][data-cache=true],[data-component]:visible").each(function(t,e){var i=$(e).attr("data-id"),n=$(e).attr("data-component");d(i,n,!0)})},d=function(t,e){v(e,function(i){if(!g[t]){var n=new i(e,t);console.log("XF :: loadChildComponent - created : "+t),g[t]=n,n.construct()}})},p=function(){$("[data-component]").on("show",function(t){if(t.currentTarget==t.target){var e=$(this).attr("data-id");if(!g[e]){var i=$(this).attr("data-component");d(e,i)}XF.UIElements.enhanceView($(this))}})},m=function(t,e){var i=document.createElement("script");i.readyState?i.onreadystatechange=function(){("loaded"==i.readyState||"complete"==i.readyState)&&(i.onreadystatechange=null,e&&e())}:i.onload=function(){e&&e()},i.src=t,document.getElementsByTagName("head")[0].appendChild(i)},g={},f={},v=function(t,e){var i=f[t];return i||(i=XF.registerComponent(t,XF.Settings.property("componentUrlFormatter")(t))),i.loaded?(e(i.compDef),void 0):(i.callbacks.push(e),i.loading||(i.loading=!0,m(i.compSrc)),void 0)};XF.getComponentByID=function(t){return g[t]},XF.registerComponent=function(t,e){var i=f[t];return i?i:(f[t]=new X(e),f[t])},XF.defineComponent=function(t,e){var i=f[t];for(i||(i=f[t]=new X(null)),f[t].loading=!1,f[t].loaded=!0,f[t].compDef=e;i.callbacks.length;)i.callbacks.pop()(i.compDef)},XF.requireComponent=function(t,e){v(t,e)};var T={};XF.setOptionsByID=function(t,e){T[t]=e};var F=function(t){return T[t]||{}};XF.history=e.history,XF.Settings={options:{applicationVersion:"1.0.0",noCache:!1,componentUrlPrefix:"",componentUrlPostfix:".js",componentUrlFormatter:function(t){return XF.Settings.property("componentUrlPrefix")+t+XF.Settings.property("componentUrlPostfix")},templateUrlPrefix:"",templateUrlPostfix:".tmpl",templateUrlFormatter:function(t,e){return XF.Settings.property("templateUrlPrefix")+e+t+XF.Settings.property("templateUrlPostfix")},dataUrlPrefix:"",dataUrlPostfix:".json",dataUrlFormatter:function(t){return XF.Settings.property("dataUrlPrefix")+t+XF.Settings.property("dataUrlPostfix")},touchableSwipeLength:100,touchableDoubleTapInterval:700,touchableLongTapInterval:500},getProperty:function(t){return this.options[t]},setProperty:function(t,e){this.options[t]=e},property:function(t,e){return void 0===e?this.getProperty(t):(this.setProperty(t,e),void 0)}},XF.Cache=null,XF.CacheClass=function(){this.storage=null,this.available=!1},_.extend(XF.CacheClass.prototype,{init:function(){this.storage=t.localStorage;try{this.storage.setItem("check","check"),this.storage.removeItem("check"),this.available=!0}catch(e){this.available=!1}var i=this.get("applicationVersion");XF.Settings.property("noCache")?(console.log("XF.Cache :: init - cache is disable for the whole app manually - clearing storage"),this.clear(),this.set("applicationVersion",XF.Settings.property("applicationVersion"))):i&&i==XF.Settings.property("applicationVersion")?console.log("XF.Cache :: init - same version is cached - useing it as much as possible"):(console.log("XF.Cache :: init - wrong or no version cached - clearing storage"),this.clear(),this.set("applicationVersion",XF.Settings.property("applicationVersion")))},get:function(t){var e;if(this.available)try{e=this.storage.getItem(t),console.log('XF.Cache :: get - "'+t+'" = "'+e+'"')}catch(i){e=null}else e=null;return e},set:function(t,e){var i;if(this.available)try{this.storage.setItem(t,e),i=!0,console.log('XF.Cache :: set - "'+t+'" = "'+e+'"')}catch(n){i=!1}else i=!1;return i},clear:function(){var t;if(this.available)try{this.storage.clear(),t=!0,console.log("XF.Cache :: clear")}catch(e){t=!1}else t=!1;return t}}),XF.Router=null,XF.RouterClass=e.Router,_.extend(XF.RouterClass.prototype,{start:function(){this.bindAnyRoute(),XF.history.start()},bindAnyRoute:function(){this.on("route",function(){console.log("XF.Router :: route: ",this.getPageNameFromFragment(XF.history.fragment)),XF.Pages.show(this.getPageNameFromFragment(XF.history.fragment))})},getPageNameFromFragment:function(t){var e=t.replace(/^\/+/,"").replace(/\/+$/,"").split("/");return e[0]}}),XF.Component=function(t,e){this.name=t||"default_name",this.id=e||"default_id",this.rendered=!1;var i=function(){this.unbind("refresh",i),this.rendered=!0};this.bind("refresh",i);var n=this.options,o=F(this.id);this.options=_.defaults(o,n)},XF.Component.template=null,XF.Component.templateURL=!1,XF.Component.templateLoaded=!1,XF.Component.templateLoading=!1,XF.Component.compiledTemplate=null,_.extend(XF.Component.prototype,XF.Events),_.extend(XF.Component.prototype,{options:{},modelClass:XF.Model,model:null,viewClass:XF.View,view:null,construct:function(){var t=function(){this.view.unbind("construct",t),this.afterConstructView(),this.init(),this.trigger("init"),this.trigger("construct"),XF.trigger(this.id+":constructed")},e=function(){this.model.unbind("construct",e),this.afterConstructModel(),this.beforeConstructView(),this.constructView(),this.view.bind("construct",t,this),this.view.construct()};this.beforeConstructModel(),this.constructModel(),this.model.bind("construct",e,this),this.model.construct(),this.childComponent=[]},selector:function(){return"[data-id="+this.id+"]"},beforeConstructView:function(){},constructView:function(){this.view&&this.view instanceof XF.View||(this.viewClass?(this.view=new this.viewClass,this.view instanceof XF.View||(this.view=new XF.View)):this.view=new XF.View),this.view.component=this},afterConstructView:function(){},beforeConstructModel:function(){},constructModel:function(){this.model&&this.model instanceof XF.Model||(this.modelClass?(this.model=new this.modelClass,this.model instanceof XF.Model||(this.model=new XF.Model)):this.model=new XF.Model),this.model.component=this},afterConstructModel:function(){},init:function(){this.refresh()},refresh:function(){var t=function(){this.model.unbind("refresh",t),this.view.refresh(),this.trigger("refresh")};this.model.bind("refresh",t,this),this.model.refresh()},ready:function(t){if(this.rendered)t();else{var e=function(){this.unbind("refresh",e),t()};this.bind("refresh",e,this)}}}),XF.Component.extend=e.Model.extend;var X=function(t){this.compSrc=t,this.compDef=null,this.loading=!1,this.loaded=!1,this.callbacks=[]};return XF.Model=e.Model.extend({component:null,rawData:null,dataURL:null,dataRequestSettings:null,isEmptyData:!1,isStaticData:!1,isStringData:!1,autoUpdateInterval:0,updateInBackground:!1,updateOnShow:!1,defaults:null,construct:function(){if(this.initialize(),this.trigger("init"),this.autoUpdateInterval>0){var t=_.bind(function(){$(this.component.selector()).is(":visible")?this.refresh():this.updateInBackground&&this.refresh()},this);setInterval(t,this.autoUpdateInterval)}this.updateOnShow&&$(this.component.selector()).bind("show",_.bind(this.refresh,this)),this.trigger("construct")},refresh:function(){var t=function(){this.unbind("dataLoaded",t),this.component.view.renderVersion,this.afterLoadData(),this.trigger("refresh")};this.bind("dataLoaded",t),this.beforeLoadData(),this.loadData()},getDataURL:function(){if(!this.dataURL){if(!this.component)throw'XF.Model "component" linkage lost';this.dataURL=_.bind(XF.Settings.property("dataUrlFormatter"),this)(this.component.name)}return this.dataURL},getDataRequestSettings:function(){return this.dataRequestSettings||{}},beforeLoadData:function(){},loadData:function(){if(this.isEmptyData||this.rawData&&this.isStaticData&&!(this.autoUpdate>0))this.trigger("dataLoaded");else{var t=this,e=this.getDataURL();$.ajax(_.extend(this.getDataRequestSettings(),{url:e,complete:function(e,i){if(!t.component)throw'XF.Model "component" linkage lost';t.rawData="success"==i?t.isStringData?e.responseText:JSON.parse(e.responseText):t.isStringData?{}:"",t.trigger("dataLoaded")}}))}},afterLoadData:function(){}}),XF.View=e.View.extend({component:null,templateURL:null,ignoreModelUpdate:!1,updateOnShow:!1,useCache:!1,construct:function(){var t=function(){return this.loadTemplateFailed?(this.unbind("templateLoaded",t),this.afterLoadTemplateFailed(),void 0):this.component.constructor.templateLoaded?(this.unbind("templateLoaded",t),this.afterLoadTemplate(),this.initialize(),this.trigger("init"),this.ignoreModelUpdate||this.component.model.bind("changed",this.refresh,this),this.updateOnShow&&$(this.component.selector()).bind("show",_.bind(this.refresh,this)),this.trigger("construct"),void 0):(this.loadTemplate(),void 0)};this.bind("templateLoaded",t),this.beforeLoadTemplate(),this.loadTemplate()},lastDeviceType:null,getTemplateURL:function(){if(this.lastDeviceType&&(this.templateURL=null),!this.templateURL){if(!this.component)throw'XF.View "component" linkage lost';if(this.lastDeviceType=XF.Device.getNextType(this.lastDeviceType),!this.lastDeviceType)return null;var t="";this.lastDeviceType&&this.lastDeviceType.templatePath&&(t=this.lastDeviceType.templatePath),this.templateURL=XF.Settings.property("templateUrlFormatter")(this.component.name,t)}return this.templateURL},getMarkup:function(){return this.component.constructor.compiledTemplate||(this.component.constructor.compiledTemplate=_.template(this.component.constructor.template)),this.component.constructor.compiledTemplate(this.component.model)},beforeLoadTemplate:function(){},loadTemplateFailed:!1,loadTemplate:function(){var t=this.getTemplateURL();if(null==t)return this.loadTemplateFailed=!0,this.trigger("templateLoaded"),void 0;if(this.useCache){var e=XF.Cache.get(t);if(e)return this.component.constructor.template=e,this.component.constructor.templateLoaded=!0,this.trigger("templateLoaded"),void 0}if(this.component.constructor.templateLoaded||this.component.constructor.templateLoading)if(this.component.constructor.templateLoading){var i=this;t=this.component.constructor.templateURL;var n=function(e){e.url==t&&(XF.unbind("templateLoaded",n),i.trigger("templateLoaded"))};XF.bind("templateLoaded",n)}else this.trigger("templateLoaded");else{this.component.constructor.templateURL=t,this.component.constructor.templateLoading=!0;var i=this;$.ajax({url:t,complete:function(e,n){if(!i.component)throw'XF.View "component" linkage lost';if("success"==n){var o=e.responseText;i.useCache&&XF.Cache.set(t,o),i.component.constructor.template=e.responseText,i.component.constructor.templateLoading=!1,i.component.constructor.templateLoaded=!0,i.trigger("templateLoaded"),XF.trigger("templateLoaded",{url:t,template:o})}else i.component.constructor.template=null,i.component.constructor.templateLoading=!1,i.component.constructor.templateLoaded=!1,i.trigger("templateLoaded"),XF.trigger("templateLoaded",{url:t,template:null})}})}},afterLoadTemplate:function(){},afterLoadTemplateFailed:function(){console.log('XF.View :: afterLoadTemplateFailed - could not load template for "'+this.component.id+'"'),console.log("XF.View :: afterLoadTemplateFailed - @dev: verify XF.Device.types settings & XF.View :: getTemplate URL overrides")},refresh:function(){this.preRender(),this.render(),this.postRender(),this.trigger("refresh")},preRender:function(){},renderVersion:0,render:function(){this.renderVersion++;var t=$("[data-id="+this.component.id+"]");t.html(this.getMarkup()),u(t)},postRender:function(){}}),XF.Pages={pageClass:"xf-page",activePageClass:"xf-page-active",animationType:"fade",activePage:null,activePageName:"",start:function(){var t=i.find(" ."+this.pageClass);if(t.length){var e=t.filter("."+this.activePageClass);e.length?(this.activePage=e,this.activePageName=e.attr("id")):this.show(t.first())}},show:function(e){if(""!==e&&e!==this.activePageName){var i=e instanceof $?e:$("."+XF.Pages.pageClass+"#"+e);if((!this.activePage||i.attr("id")!=this.activePage.attr("id"))&&i.length){console.log("XF.Pages :: showing to page",i.attr("id"));var n=XF.Device.getViewport(),o=XF.Device.getScreenHeight(),s=this.animationType,a=this.activePageClass,r=this.activePage,c=i;this.activePage=c,this.activePageName=i.attr("id"),r?(n.addClass("xf-viewport-transitioning"),r.height(o+$(t).scrollTop()).addClass("out "+s),c.height(o+$(t).scrollTop()).addClass("in "+s+" "+a),r.animationComplete(function(){r.height("").removeClass(s+" out in reverse"),r.attr("id")!=XF.Pages.activePage.attr("id")&&r.removeClass(a)}),c.animationComplete(function(){c.height("").removeClass(s+" out in reverse"),n.removeClass("xf-viewport-transitioning")})):this.activePage.addClass(a),t.scrollTo(0,1),u(this.activePage[0])}}}},XF.on("page:show",_.bind(XF.Pages.show,XF.Pages)),XF.Device={size:{width:0,height:0},isMobile:/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino|1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test((navigator.userAgent||navigator.vendor||t.opera).toLowerCase()),types:[{name:"desktop",range:{max:null,min:1025},templatePath:"desktop/",fallBackTo:"tablet"},{name:"tablet",range:{max:1024,min:480},templatePath:"tablet/",fallBackTo:"mobile"},{name:"mobile",range:{max:480,min:null},templatePath:"mobile/",fallBackTo:"default"}],defaultType:{name:"default",range:{min:null,max:null},templatePath:"",fallBackTo:null},type:this.defaultType,isTouchable:!1,init:function(t){this.types=t||this.types,this.detectType(),this.detectTouchable()},detectType:function(){this.size.width=$(t).width(),this.size.height=$(t).height(),console.log('XF.DeviceClass :: detectType - width = "'+this.size.width+'"'),console.log('XF.DeviceClass :: detectType - height = "'+this.size.height+'"');var e=Math.max(this.size.width,this.size.height);console.log('XF.DeviceClass :: detectType - maxSide = "'+e+'"');var i=null;_.each(this.types,function(t){try{(!t.range.min||t.range.min&&e>t.range.min)&&(!t.range.max||t.range.max&&t.range.max>e)&&(i=t)}catch(n){console.log("XF.DeviceClass :: detectType - bad type detected - skipping"),console.log("XF.DeviceClass :: detectType - @dev: plz verify types list")}}),i?this.type=i:(this.type=this.defaultType,console.log("XF.DeviceClass :: detectType - could not choose any of device type"),console.log("XF.DeviceClass :: detectType - drop back to this.defaultType"),console.log("XF.DeviceClass :: detectType - @dev: plz verify types list")),console.log('XF.DeviceClass :: detectType - selected type "'+this.type.name+'"')},getNextType:function(t){var e=this.type;return t&&(e=t.fallBackTo?this.getTypeByName(t.fallBackTo):this.defaultType),e&&e.templatePath||(e=this.defaultType),e==t?(console.log("XF.DeviceClass :: getNextType - infinit cycle of drop down logic detected"),console.log("XF.DeviceClass :: getNextType - stop trying, no template is available"),null):e},getTypeByName:function(t){var e=null;return _.each(this.types,function(i){try{i.name==t&&(e=i)}catch(n){console.log("XF.DeviceClass :: getTypeByName - bad type name - skipping"),console.log("XF.DeviceClass :: getTypeByName - @dev: plz verify types list")}}),e},detectTouchable:function(){var e=" -webkit- -moz- -o- -ms- ".split(" "),i=["@media (",e.join("touch-enabled),("),"app_device_test",")","{#touch{top:9px;position:absolute}}"].join(""),n=this;this.injectElementWithStyles(i,function(e){var i=document.styleSheets[document.styleSheets.length-1],o=(i?i.cssRules&&i.cssRules[0]?i.cssRules[0].cssText:i.cssText||"":"",e.childNodes),s=o[0];n.isTouchable="ontouchstart"in t||t.DocumentTouch&&document instanceof DocumentTouch||9===(s&&s.offsetTop)},1,["touch"]),console.log("XF.Device :: detectTouchable - device IS "+(this.isTouchable?"":"NOT ")+"touchable")},injectElementWithStyles:function(t,e,i,n){var o,s,a,r=document.createElement("div"),c=document.body,h=c?c:document.createElement("body");if(parseInt(i,10))for(;i--;)a=document.createElement("div"),a.id=n?n[i]:"app_device_test"+(i+1),r.appendChild(a);return o=["&#173;","<style>",t,"</style>"].join(""),r.id="app_device_test",h.innerHTML+=o,h.appendChild(r),c||(h.style.background="",docElement.appendChild(h)),s=e(r,t),c?r.parentNode.removeChild(r):h.parentNode.removeChild(h),!!s},ORIENTATION_PORTRAIT:"portrait",ORIENTATION_LANDSCAPE:"landscape",getOrientation:function(){var t=!0,e=document.documentElement;return void 0!==$.support||(t=e&&1.1>e.clientWidth/e.clientHeight),t?this.ORIENTATION_PORTRAIT:this.ORIENTATION_LANDSCAPE},getScreenHeight:function(){var e=this.getOrientation(),i=e===this.ORIENTATION_PORTRAIT,n=i?480:320,o=i?screen.availHeight:screen.availWidth,s=Math.max(n,$(t).height()),a=Math.min(o,s);return a},getViewport:function(){var t=$("body").addClass("xf-viewport");return t[0]||(t=$(".xf-page").eq(0),t=t.length?t.parent():$("body"),t.addClass("xf-viewport")),t.eq(0)}},XF.trace=function(t){$("#tracer").html(t+"<br/>"+$("#tracer").html())},t.XF=XF}).call(this,window,Backbone),function(){$.fn.touchable=function(t){return this.each(function(){return $(this).data("touchable")||$(this).data("touchable",new XF.Touchable(this,t)),$(this).data("touchable")})},XF.TouchGesture=function(t,e,i){this.touchable=t,this.fingerID=e,this.startPosition=i,this.currentPosition=i,this.previousPosition=i,this.previousDelta={x:0,y:0},this.startDelta={x:0,y:0},this.swipeAngle=0,this.swipeLength=0,this.swipeDirection=XF.TouchGesture.SWIPE_DIRECTION_LEFT,this.longTouchHandler=_.bind(this.longTouchHandlerF,this),this.longTouchTimeout=setTimeout(this.longTouchHandler,this.touchable.options.longTapInterval),this.longTouchDispatched=!1,this.gestureComplete=!1,this.dispatch(XF.TouchGesture.TOUCH_START_EVENT)},_.extend(XF.TouchGesture.prototype,{move:function(t){this.previousPosition=this.currentPosition,this.currentPosition=t,this.previousDelta.x=this.currentPosition.x-this.previousPosition.x,this.previousDelta.y=this.currentPosition.y-this.previousPosition.y,this.startDelta.x=this.currentPosition.x-this.startPosition.x,this.startDelta.y=this.currentPosition.y-this.startPosition.y,this.checkSwipe(),this.dispatch(XF.TouchGesture.TOUCH_MOVE_EVENT)},checkSwipe:function(){if(this.swipeLength=Math.round(Math.sqrt(Math.pow(this.startDelta.x,2)+Math.pow(this.startDelta.y,2))),this.swipeLength>this.touchable.options.swipeLength){var t=Math.atan2(this.startDelta.y,this.startDelta.x);this.swipeAngle=Math.round(180*t/Math.PI),0>this.swipeAngle&&(this.swipeAngle=360-Math.abs(this.swipeAngle)),this.swipeDirection=45>=this.swipeAngle&&this.swipeAngle>=0?XF.TouchGesture.SWIPE_DIRECTION_RIGHT:360>=this.swipeAngle&&this.swipeAngle>=315?XF.TouchGesture.SWIPE_DIRECTION_RIGHT:this.swipeAngle>=135&&225>=this.swipeAngle?XF.TouchGesture.SWIPE_DIRECTION_LEFT:this.swipeAngle>45&&135>this.swipeAngle?XF.TouchGesture.SWIPE_DIRECTION_DOWN:XF.TouchGesture.SWIPE_DIRECTION_UP,this.dispatch(XF.TouchGesture.SWIPE_EVENT),this.touchable.destroyGesture(this.fingerID)}},longTouchHandlerF:function(){this.dispatch(XF.TouchGesture.LONG_TAP_EVENT),this.longTouchDispatched=!0},release:function(){this.gestureComplete||this.longTouchDispatched||(clearTimeout(this.longTouchTimeout),this.dispatch(XF.TouchGesture.TAP_EVENT),this.touchable.lastTapTimestamp+this.touchable.options.doubleTapInterval>XF.TouchGesture.getTimeStamp()?(this.dispatch(XF.TouchGesture.DOUBLE_TAP_EVENT),this.touchable.lastTapTimestamp=0):this.touchable.lastTapTimestamp=XF.TouchGesture.getTimeStamp()),this.gestureComplete=!0,this.dispatch(XF.TouchGesture.TOUCH_END_EVENT),this.touchable.destroyGesture(this.fingerID)},dispatch:function(t){console.log("XF.TouchGesture :: dispatch - "+t+" ("+this.fingerID+")"),$(this.touchable.elem).trigger(t,this)}}),_.extend(XF.TouchGesture,{TOUCH_START_EVENT:"TOUCH_START",TOUCH_MOVE_EVENT:"TOUCH_MOVE",TOUCH_END_EVENT:"TOUCH_END",TAP_EVENT:"TAP",SWIPE_EVENT:"SWIPE",LONG_TAP_EVENT:"LONG_TAP",DOUBLE_TAP_EVENT:"DOUBLE_TAP",SWIPE_DIRECTION_LEFT:"LEFT",SWIPE_DIRECTION_RIGHT:"RIGHT",SWIPE_DIRECTION_UP:"UP",SWIPE_DIRECTION_DOWN:"DOWN",getTimeStamp:function(){return(new Date).getTime()}}),XF.Touchable=function(t,e){this.elem=t,this.$elem=$(t),this.options=e?_.clone(e):{},_.defaults(this.options,{swipeLength:XF.Settings.property("touchableSwipeLength"),doubleTapInterval:XF.Settings.property("touchableDoubleTapInterval"),longTapInterval:XF.Settings.property("touchableLongTapInterval")}),this.gestures={},this.lastTapTimestamp=0,this.touchstart=_.bind(this.touchstartF,this),this.touchmove=_.bind(this.touchmoveF,this),this.touchend=_.bind(this.touchendF,this),XF.Device.isTouchable?$(t).bind("touchstart",this.touchstart):$(t).bind("mousedown",this.touchstart)},_.extend(XF.Touchable.prototype,{getGestureByID:function(t){return this.gestures[t]},createGesture:function(t,e){return this.gestures[t]=new XF.TouchGesture(this,t,e)},destroyGesture:function(t){delete this.gestures[t],0==_.size(this.gestures)&&(XF.Device.isTouchable?($(document).unbind("touchmove",this.touchmove),$(document).unbind("touchend",this.touchend)):($(document).unbind("mousemove",this.touchmove),$(document).unbind("mouseup",this.touchend)))},touchstartF:function(t){if(t=t.originalEvent||t,void 0!=t.changedTouches){var e=this;_.each(t.changedTouches,function(t){e.createGesture(t.identifier,{x:t.clientX,y:t.clientY})}),$(document).bind("touchmove",this.touchmove),$(document).bind("touchend",this.touchend)}else this.createGesture("mouse",{x:t.pageX,y:t.pageY}),$(document).bind("mousemove",this.touchmove),$(document).bind("mouseup",this.touchend)},touchmoveF:function(t){if(t=t.originalEvent||t,void 0!=t.changedTouches){var e=this;_.each(t.changedTouches,function(t){var i=e.getGestureByID(t.identifier);i&&i.move({x:t.clientX,y:t.clientY})})}else{var i=this.getGestureByID("mouse");i&&i.move({x:t.pageX,y:t.pageY})}},touchendF:function(t){if(t=t.originalEvent||t,t.changedTouches!==void 0){var e=this;_.each(t.changedTouches,function(t){var i=e.getGestureByID(t.identifier);i&&i.release()})}else{var i=this.getGestureByID("mouse");i&&i.release()}}})}.call(this,window,Backbone),function(){$.fn.outerHtml=function(t){if(t)return this.each(function(){$(this).replaceWith(t)});var e=$("<div></div>").append($(this).clone()),i=e.html();return e.remove(),i}}.call(this,window,Backbone),function(){XF.UIElements={},_.extend(XF.UIElements,{enhanceView:function(t){!t instanceof $&&(t=$(t),!t instanceof $)||_.each(XF.UIElements.enhancementList,function(e){t.find(e.selector).not("[data-skip-enhance=true]").each(function(){var t=!1;_.each(XF.UIElements.enhanced.length,function(){XF.UIElements.enhanced[i]===this&&(t=!0)}),!t&"true"!=$(this).attr("data-skip-enhance")&&(XF.UIElements.enhanced.push(this),XF.UIElements[e.enhanceMethod](this))})})},enhancementList:{},enhanced:[]})}.call(this,window,Backbone);